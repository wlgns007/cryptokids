<!DOCTYPE html>
<html lang="en">
<head>
  <link rel="icon" href="data:,">
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>CryptoKids — Admin</title>
  <style>
    :root { --fg:#222; --muted:#666; --line:#e6e6e6; --bg:#fafafa; }
    * { box-sizing:border-box }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji"; color:var(--fg); background:#fff; margin:0; }
    header { padding:14px 16px; border-bottom:1px solid var(--line); display:flex; align-items:center; gap:10px; }
    h1 { font-size:18px; margin:0 8px 0 0; }
    small { color:var(--muted); }

    .wrap { padding:16px; display:grid; grid-template-columns: 420px 1fr; gap:18px; }
    .card { border:1px solid var(--line); border-radius:12px; padding:14px; background:var(--bg); }
    .card h2 { font-size:16px; margin:0 0 10px 0; }

    label.inline { display:inline-flex; align-items:center; gap:8px; font-size:13px; color:var(--muted); }

    .row { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    .row > input[type="text"], .row > input[type="number"] { flex:1; padding:8px 10px; border:1px solid var(--line); border-radius:8px; }
    .row > button { padding:8px 12px; border:1px solid var(--line); background:#fff; border-radius:10px; cursor:pointer; }

    .help { color:var(--muted); font-size:12px; }

    /* Uploader */
    .drop { border:2px dashed var(--line); border-radius:12px; padding:18px; text-align:center; background:#fff; cursor:pointer; }
    .drop.drag { border-color:#8aa8ff; background:#f3f7ff; }
    #uploadStatus { font-size:12px; color:var(--muted); margin-top:6px; min-height:18px; }

    /* Rewards list */
    #rewardsList { display:flex; flex-direction:column; gap:10px; }
    .reward { display:grid; grid-template-columns: 56px 1fr auto; gap:10px; align-items:center; background:#fff; border:1px solid var(--line); border-radius:10px; padding:8px; }
    .reward .meta { display:flex; flex-direction:column; gap:4px; }
    .reward .meta .name { font-weight:600; font-size:14px; }
    .reward .meta .url { color:var(--muted); font-size:12px; }
    .reward .actions { display:flex; gap:8px; }
    .reward button { padding:6px 10px; border:1px solid var(--line); background:#fff; border-radius:8px; cursor:pointer; }

    /* Lightbox */
    #imgModal { position:fixed; inset:0; background:rgba(0,0,0,.72); display:none; align-items:center; justify-content:center; z-index:9999 }
    #imgModal img { max-width:92vw; max-height:92vh; border-radius:12px; box-shadow:0 10px 36px rgba(0,0,0,.55) }

    /* Tiny inputs in header */
    #adminKey { width:220px; padding:6px 8px; border:1px solid var(--line); border-radius:8px; }
    #saveAdminKey { padding:6px 10px; border:1px solid var(--line); border-radius:8px; background:#fff; cursor:pointer; }

   /* Hides anything wrapped in .url when OFF */
   .hide-urls .url { display:none; }

    .hidden{display:none}
  #toastHost{position:fixed;right:16px;bottom:16px;z-index:9999}
  .toast{padding:.6rem .8rem;margin-top:.5rem;border-radius:10px;background:#222;color:#fff;box-shadow:0 4px 14px rgba(0,0,0,.2);opacity:0;transform:translateY(6px);transition:opacity .2s,transform .2s}
  .toast.show{opacity:1;transform:translateY(0)}
  .toast.success{background:#125b12}
  .toast.error{background:#8a1f1f}
  </style>
</head>
<link rel="icon" href="data:,">
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#ffffff">
<script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => navigator.serviceWorker.register('/sw.js'));
  }
</script>
<body>
  <header>
    <h1>Manage Rewards</h1>

    <div style="margin-left:auto; display:flex; align-items:center; gap:8px;">
      <small>Admin Key</small>
      <input id="adminKey" type="text" placeholder="enter admin key"/>
      <button id="saveAdminKey">Save</button>
    </div>
  </header>

  <div class="wrap">

  <!-- 1) Issue first -->
  <section class="card" style="grid-column: 1 / -1;">
    <h2>Issue (legacy)</h2>
    <div class="row"><input id="issUserId" type="text" placeholder="User ID (e.g., leo)"></div>
    <div class="row"><input id="issAmount" type="number" min="1" step="1" placeholder="Amount (points)"></div>
    <div class="row"><input id="issTask" type="text" placeholder="Task / note (optional)"></div>
    <div class="row" style="gap:10px;flex-wrap:wrap">
      <button id="btnMintQR">Generate Earn QR</button>
      <button id="btnSpend">Spend</button>
      <button id="btnCheck">Check Balance</button>
    </div>
    <div id="qr" style="margin-top:8px;"></div>
    <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
      <input id="qrLink" type="text" readonly style="flex:1;padding:6px 8px;border:1px solid #ddd;border-radius:8px">
      <button id="btnCopy" style="padding:6px 10px;border:1px solid #ddd;border-radius:8px;background:#fff">Copy</button>
    </div>
    <div id="qrHelp" class="help" style="margin-top:6px"></div>
    <div id="issueStatus" class="help" style="min-height:18px;"></div>
  </section>

  <!-- 2) New Reward (with OPTIONAL uploader inside) -->
  <section class="card" style="grid-column: 1 / -1;">
    <h2>New Reward</h2>
    <div class="row"><input id="rName" type="text" placeholder="Reward name (e.g., Sticker Pack)"></div>
    <div class="row">
      <input id="rPrice" type="number" min="1" step="1" placeholder="Cost (points)">
      <button id="btnAddReward">Add</button>
    </div>
    <div class="row"><input id="rImg" type="text" placeholder="Image URL (optional — auto-filled if you upload below)"></div>

    <!-- Optional Uploader -->
    <div style="margin-top:10px;">
      <div id="drop" class="drop">
        <div><b>Drop image here</b> or click to choose</div>
        <div class="help">Supported: jpg, jpeg, png, webp, gif</div>
        <input id="file" type="file" accept="image/*" style="display:none">
      </div>
      <div id="uploadStatus"></div>
      <div class="help">Tip: upload first (optional) — the URL fills into the field above.</div>
    </div>

  </section>

  <!-- 3) Rewards at the very bottom; start empty until Load clicked -->
  <section class="card" style="grid-column: 1 / -1;">
    <h2 style="display:flex;align-items:center;gap:12px;margin:0 0 10px 0;">
      <span>Rewards</span>

      <button id="btnLoadRewards"
              style="padding:6px 10px;border:1px solid var(--line);border-radius:8px;background:#fff">
        Load items
      </button>
      <label class="inline" title="Show/Hide raw image URLs">
        <input id="toggleUrls" type="checkbox" />
        <span>Show image URLs</span>
      </label>
    </h2>
    <div class="row" style="margin-top:6px">
      <input id="filterRewards" type="text" placeholder="Search rewards…" />
      <span id="rewardsCount" class="help"></span>
    </div>

    <div id="rewardsList"></div>
    <div id="emptyRewards" class="hidden">No rewards yet. Click “Add Reward”.</div>
    <div id="rewardsMsg" class="help" style="margin-top:8px;">(Click “Load items” to fetch rewards.)</div>
  </section>

</div>
    <div id="imgModal"><img id="imgModalImg" alt=""></div>

  <!-- QR library (for Generate Earn QR) -->
  <script src="/qrcode.min.js"></script>

  <!-- Admin JS -->
  <script src="/admin.js?v=ck5"></script>

  <div id="toastHost" aria-live="polite"></div>

</body>
</html>
